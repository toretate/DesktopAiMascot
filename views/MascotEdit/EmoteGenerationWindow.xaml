<Window x:Class="DesktopAiMascot.views.MascotEdit.EmoteGenerationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DesktopAiMascot.views.MascotEdit"
        mc:Ignorable="d"
        Title="表情差分作成" Height="700" Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="White">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ヘッダー：元画像と設定 -->
        <GroupBox Header="設定" Grid.Row="0" Padding="10" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- 元画像 -->
                <Border Grid.Column="0" BorderBrush="LightGray" BorderThickness="1" 
                        Width="180" Height="180" Margin="0,0,10,0">
                    <Image x:Name="sourceImage" Stretch="Uniform"/>
                </Border>

                <!-- 設定 -->
                <StackPanel Grid.Column="1">
                    <Label Content="画像生成AI" FontWeight="Bold" FontSize="12" Padding="0" Margin="0,0,0,5"/>
                    <ComboBox x:Name="aiServiceComboBox" 
                              Height="30" 
                              Margin="0,0,0,15"
                              SelectedIndex="0">
                        <ComboBoxItem Content="Nano Banana"/>
                        <ComboBoxItem Content="Nano Banana Pro"/>
                        <ComboBoxItem Content="Comfy - Qwen3ImageEdit"/>
                    </ComboBox>

                    <Label Content="プロンプト調整" FontWeight="Bold" FontSize="12" Padding="0" Margin="0,0,0,5"/>
                    <TextBox x:Name="promptAdjustTextBox" 
                             Height="60" 
                             TextWrapping="Wrap"
                             AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"
                             Text="high quality, detailed"
                             Margin="0,0,0,10"/>

                    <Button x:Name="generateAllButton" 
                            Content="全ての表情を生成" 
                            Height="40"
                            Click="GenerateAllButton_Click"
                            FontWeight="Bold"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- 表情差分一覧 -->
        <GroupBox Header="表情差分" Grid.Row="1" Padding="10">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="emoteItemsControl">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="LightGray" 
                                    BorderThickness="0,0,0,1" 
                                    Padding="10" 
                                    Margin="0,0,0,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 表情名 -->
                                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding EmoteName}" 
                                                   FontWeight="Bold" 
                                                   FontSize="14"
                                                   Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding Description}" 
                                                   FontSize="11"
                                                   Foreground="Gray"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>

                                    <!-- プレビュー画像 -->
                                    <Border Grid.Column="1" 
                                            BorderBrush="LightGray" 
                                            BorderThickness="1" 
                                            Margin="10,0"
                                            Width="180" 
                                            Height="180">
                                        <Grid>
                                           <Image Source="{Binding DisplayImage}" 
                                                   Stretch="Uniform"/>
                                            <!-- 生成中ラベル -->
                                            <TextBlock Text="{Binding StatusText}"
                                                       VerticalAlignment="Center"
                                                       HorizontalAlignment="Center"
                                                       Background="#C0000000"
                                                       Foreground="White"
                                                       Padding="15,10"
                                                       FontSize="14"
                                                       FontWeight="Bold"
                                                       TextAlignment="Center">
                                                <TextBlock.Effect>
                                                    <DropShadowEffect Color="Black" BlurRadius="3" Opacity="0.8"/>
                                                </TextBlock.Effect>
                                            </TextBlock>
                                        </Grid>
                                    </Border>

                                    <!-- プロンプト -->
                                    <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="10,0">
                                        <Label Content="プロンプト" FontSize="10" Padding="0" Margin="0,0,0,2"/>
                                        <TextBox Text="{Binding Prompt, Mode=TwoWay}" 
                                                 Height="60"
                                                 TextWrapping="Wrap"
                                                 AcceptsReturn="True"
                                                 VerticalScrollBarVisibility="Auto"
                                                 FontSize="11"/>
                                    </StackPanel>

                                    <!-- アクションボタン -->
                                    <StackPanel Grid.Column="3" VerticalAlignment="Center">
                                        <Button Content="生成" 
                                                Width="80" 
                                                Height="30"
                                                Margin="0,0,0,5"
                                                Click="GenerateEmoteButton_Click"
                                                Tag="{Binding}"/>
                                        <Button Content="保存" 
                                                Width="80" 
                                                Height="30"
                                                IsEnabled="{Binding HasImage}"
                                                Click="SaveEmoteButton_Click"
                                                Tag="{Binding}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </GroupBox>

        <!-- フッター -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button x:Name="saveAllButton" 
                    Content="全て保存" 
                    Width="120" 
                    Height="35"
                    Margin="0,0,10,0"
                    Click="SaveAllButton_Click"/>
            <Button x:Name="closeButton" 
                    Content="閉じる" 
                    Width="100" 
                    Height="35"
                    Click="CloseButton_Click"/>
        </StackPanel>
    </Grid>
</Window>
